<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gr치ficas de Peso por ID y Grupo</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
  body {
    font-family: Georgia, 'Times New Roman', Times, serif;
    margin: 20px;
    background: #f4f7fa;
    color: #333;
  }
  h2 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 30px;
    font-weight: normal;
  }
  .tab {
    overflow: hidden;
    border-bottom: 3px solid #2980b9;
    max-width: 900px;
    margin: 0 auto 20px auto;
    border-radius: 8px 8px 0 0;
    background: #ecf0f1;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }
  .tab button {
    background-color: #ecf0f1;
    border: none;
    outline: none;
    cursor: pointer;
    padding: 14px 28px;
    transition: background-color 0.3s ease, color 0.3s ease;
    font-size: 16px;
    font-weight: 600;
    color: #34495e;
    border-radius: 8px 8px 0 0;
    margin-right: 4px;
    font-family: Georgia, 'Times New Roman', Times, serif;
  }
  .tab button:hover {
    background-color: #d0d7de;
    color: #1a5276;
  }
  .tab button.active {
    background-color: #2980b9;
    color: white;
    box-shadow: 0 4px 8px rgba(41, 128, 185, 0.4);
  }
  .tabcontent {
    display: none;
    max-width: 900px;
    margin: 0 auto;
    background: white;
    padding: 20px 30px 30px 30px;
    border-radius: 0 0 8px 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    font-family: Georgia, 'Times New Roman', Times, serif;
  }
  .plot-container {
    width: 100%;
    height: 600px;
    overflow-y: auto;
  }
  .notes-section {
    margin-top: 30px;
    border-top: 2px solid #2980b9;
    padding-top: 20px;
  }
  .notes-section h3 {
    color: #2980b9;
    margin-bottom: 10px;
  }
  .notes-input {
    width: 100%;
    height: 80px;
    font-family: Georgia, 'Times New Roman', Times, serif;
    font-size: 14px;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    resize: vertical;
    box-sizing: border-box;
  }
  .notes-buttons {
    margin-top: 10px;
    text-align: right;
  }
  .notes-buttons button {
    background-color: #2980b9;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-family: Georgia, 'Times New Roman', Times, serif;
    font-size: 14px;
    transition: background-color 0.3s ease;
  }
  .notes-buttons button:hover {
    background-color: #1a5276;
  }
  .notes-list {
    margin-top: 20px;
    list-style-type: none;
    padding-left: 0;
  }
  .notes-list li {
    background-color: #eaf3fb;
    border-left: 4px solid #2980b9;
    padding: 10px 15px;
    margin-bottom: 10px;
    border-radius: 4px;
    white-space: pre-wrap;
  }
  footer {
    text-align: center;
    margin-top: 40px;
    color: #7f8c8d;
    font-size: 16px;
    font-family: Georgia, 'Times New Roman', Times, serif;
    font-style: italic;
  }
</style>
</head>
<body>

<h2>Gr치ficas de Peso por ID y Grupo</h2>

<div class="tab">
  <button class="tablinks" onclick="openGroup(event, 'Control')" id="defaultOpen">Control</button>
  <button class="tablinks" onclick="openGroup(event, 'HFD')">HFD</button>
  <button class="tablinks" onclick="openGroup(event, 'Letrozol')">Letrozol</button>
  <button class="tablinks" onclick="openGroup(event, 'HFD+LET')">HFD+LET</button>
</div>

<div id="Control" class="tabcontent">
  <div id="plot-Control" class="plot-container"></div>
  <div class="notes-section">
    <h3>Notas</h3>
    <textarea id="input-Control" class="notes-input" placeholder="Escribe una nota..."></textarea>
    <div class="notes-buttons">
      <button onclick="addNote('Control')">Agregar nota</button>
    </div>
    <ul id="list-Control" class="notes-list"></ul>
  </div>
</div>

<div id="HFD" class="tabcontent">
  <div id="plot-HFD" class="plot-container"></div>
  <div class="notes-section">
    <h3>Notas</h3>
    <textarea id="input-HFD" class="notes-input" placeholder="Escribe una nota..."></textarea>
    <div class="notes-buttons">
      <button onclick="addNote('HFD')">Agregar nota</button>
    </div>
    <ul id="list-HFD" class="notes-list"></ul>
  </div>
</div>

<div id="Letrozol" class="tabcontent">
  <div id="plot-Letrozol" class="plot-container"></div>
  <div class="notes-section">
    <h3>Notas</h3>
    <textarea id="input-Letrozol" class="notes-input" placeholder="Escribe una nota..."></textarea>
    <div class="notes-buttons">
      <button onclick="addNote('Letrozol')">Agregar nota</button>
    </div>
    <ul id="list-Letrozol" class="notes-list"></ul>
  </div>
</div>

<div id="HFD+LET" class="tabcontent">
  <div id="plot-HFD+LET" class="plot-container"></div>
  <div class="notes-section">
    <h3>Notas</h3>
    <textarea id="input-HFD+LET" class="notes-input" placeholder="Escribe una nota..."></textarea>
    <div class="notes-buttons">
      <button onclick="addNote('HFD+LET')">Agregar nota</button>
    </div>
    <ul id="list-HFD+LET" class="notes-list"></ul>
  </div>
</div>

<footer>
  &copy; 2025 Datos de Peso - Visualizaci칩n Interactiva
</footer>

<script>
const fechas = ['27-jul-25', '04-jul-25', '10-jul-25', '17-jul-25', '24-jul-25', '31-jul-25', '07-ago-25', '14-ago-25', '21-ago-25', '28-ago-25'];
const semanas = ['Semana 3', 'Semana 4', 'Semana 5', 'Semana 6', 'Semana 7', 'Semana 8', 'Semana 9', 'Semana 10', 'Semana 11', 'Semana 12'];

const data = [
  {ID:1, Condicion:'Control', pesos:[47,88,135,158,185,216,237,245,252,266]},
  {ID:2, Condicion:'Control', pesos:[46,83,125,152,178,210,226,236,201,189]},
  {ID:3, Condicion:'Control', pesos:[41,76,113,136,160,188,195,208,218,226]},
  {ID:4, Condicion:'Control', pesos:[48,90,132,162,180,212,229,251,273,283]},
  {ID:5, Condicion:'Control', pesos:[47,89,136,167,194,222,237,253,269,268]},
  {ID:6, Condicion:'Control', pesos:[44,80,122,153,171,206,219,230,238,246]},
  {ID:7, Condicion:'Control', pesos:[49,86,124,148,168,196,210,229,243,247]},
  {ID:8, Condicion:'Control', pesos:[46,80,118,142,158,183,195,212,231,246]},

  {ID:9, Condicion:'HFD', pesos:[43,73,103,123,169,199,223,242,250,268]},
  {ID:10, Condicion:'HFD', pesos:[41,63,88,121,152,175,195,224,243,250]},
  {ID:11, Condicion:'HFD', pesos:[44,71,102,133,163,191,213,232,252,264]},
  {ID:12, Condicion:'HFD', pesos:[39,68,102,142,173,204,231,257,277,288]},
  {ID:13, Condicion:'HFD', pesos:[38,63,91,120,149,175,206,226,242,250]},
  {ID:14, Condicion:'HFD', pesos:[40,67,96,128,163,186,214,233,240,251]},
  {ID:15, Condicion:'HFD', pesos:[45,74,105,132,157,185,203,215,228,242]},
  {ID:16, Condicion:'HFD', pesos:[38,60,86,124,154,186,212,235,255,273]},

  {ID:17, Condicion:'Letrozol', pesos:[47,65,103,141,172,200,224,235,244,263]},
  {ID:18, Condicion:'Letrozol', pesos:[45,61,106,147,181,213,237,265,282,284]},
  {ID:19, Condicion:'Letrozol', pesos:[46,70,109,140,168,194,174,168,null,null]},
  {ID:20, Condicion:'Letrozol', pesos:[48,66,105,145,173,201,220,238,260,260]},
  {ID:21, Condicion:'Letrozol', pesos:[48,73,118,159,184,204,224,241,259,268]},
  {ID:22, Condicion:'Letrozol', pesos:[41,60,103,140,169,205,239,238,256,263]},

  {ID:23, Condicion:'HFD+LET', pesos:[45,79,108,137,167,197,218,236,253,265]},
  {ID:24, Condicion:'HFD+LET', pesos:[47,85,115,148,175,213,236,258,271,296]},
  {ID:25, Condicion:'HFD+LET', pesos:[39,73,107,143,171,198,221,241,253,262]},
  {ID:26, Condicion:'HFD+LET', pesos:[53,85,117,118,183,214,242,254,267,275]},
  {ID:27, Condicion:'HFD+LET', pesos:[38,64,90,122,156,185,210,232,251,260]},
  {ID:28, Condicion:'HFD+LET', pesos:[45,81,109,148,175,214,255,266,277,293]},
  {ID:29, Condicion:'HFD+LET', pesos:[33,61,86,152,142,168,192,209,218,231]},
  {ID:30, Condicion:'HFD+LET', pesos:[48,82,114,160,188,214,245,240,246,257]}
];

const colors = [
  '#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b',
  '#e377c2', '#7f7f7f', '#bcbd22', '#17becf', '#393b79', '#637939',
  '#8c6d31', '#843c39', '#7b4173', '#3182bd', '#e6550d', '#31a354',
  '#756bb1', '#636363', '#e7ba52', '#ad494a', '#a55194', '#6b6ecf',
  '#b5cf6b', '#de9ed6', '#9c9ede', '#cedb9c', '#f7b6d2', '#c7c7c7'
];

function crearGraficos(grupo) {
  const containerId = 'plot-' + grupo;
  const container = document.getElementById(containerId);
  container.innerHTML = '';

  const grupoData = data.filter(d => d.Condicion === grupo);

  const traces = grupoData.map((d, i) => ({
    x: fechas,
    y: d.pesos,
    mode: 'lines+markers',
    name: 'ID ' + d.ID,
    connectgaps: true,
    line: { color: colors[i % colors.length], width: 2 },
    marker: { size: 6 }
  }));

  let annotations = [];

  if (grupo === 'Letrozol') {
    const id19 = grupoData.find(d => d.ID === 19);
    if (id19) {
      let lastIndex = id19.pesos.length - 1;
      while (lastIndex >= 0 && (id19.pesos[lastIndex] === null || id19.pesos[lastIndex] === undefined)) {
        lastIndex--;
      }
      if (lastIndex >= 0) {
        annotations.push({
          x: fechas[lastIndex],
          y: id19.pesos[lastIndex],
          xref: 'x',
          yref: 'y',
          text: 'Falleci칩',
          showarrow: true,
          arrowhead: 2,
          ax: 0,
          ay: -40,
          font: { color: 'red', size: 14, family: 'Georgia, serif' }
        });
      }
    }
  }

  const tickvals = fechas;
  const ticktext = fechas.map((fecha, i) => `${fecha}<br>${semanas[i]}`);

  const layout = {
    title: {
      text: `Peso a lo largo del tiempo - Grupo ${grupo}`,
      font: { size: 22, color: '#34495e', family: 'Georgia, serif' }
    },
    xaxis: {
      title: 'Fecha / Semana',
      tickvals: tickvals,
      ticktext: ticktext,
      tickangle: -45,
      tickfont: { size: 12, color: '#34495e', family: 'Georgia, serif' },
      zeroline: false,
      automargin: true
    },
    yaxis: {
      title: 'Peso',
      tickfont: { size: 12, color: '#34495e', family: 'Georgia, serif' },
      zeroline: false
    },
    height: 600,
    legend: {
      orientation: "h",
      y: -0.25,
      font: { size: 12, family: 'Georgia, serif' },
      bgcolor: 'rgba(0,0,0,0)'
    },
    margin: { t: 80, b: 140 },
    annotations: annotations,
    plot_bgcolor: '#ffffff',
    paper_bgcolor: '#ffffff'
  };

  Plotly.newPlot(containerId, traces, layout, {responsive: true});
}

function openGroup(evt, groupName) {
  const tabcontent = document.getElementsByClassName("tabcontent");
  for (let i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  const tablinks = document.getElementsByClassName("tablinks");
  for (let i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(groupName).style.display = "block";
  evt.currentTarget.className += " active";

  crearGraficos(groupName);
}

document.getElementById("defaultOpen").click();
</script>

</body>
</html>
